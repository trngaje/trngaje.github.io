---
layout: posts
title:  "ogu sdl2 관련"
comments: true
categories : [ogu]
tags : [ogu,odroid go ultra,오드로이드,sdl2]
---

### SDL2 build

ge2d 로 구동한 소스 위치는 아래와 같습니다.

    git clone -b 2.0.22 https://github.com/JohnnyonFlame/SDL-ge2d.git

ge2d 를 사용하지 않는 sdl2 소스는 아래와 같습니다.

    git clone -b fbdev-noge2d https://github.com/JohnnyonFlame/SDL-ge2d.git

전체 dependency 는 아래와 같음

    sudo apt-get install libx11-dev libsm-dev libxext-dev git cmake mercurial libudev-dev libdrm-dev zlib1g-dev pkg-config libasound2-dev libfreetype6-dev libx11-xcb1 libxcb-dri2-0
    sudo apt-get install libglfw3-dev libgles2-mesa-dev mesa-utils-extra libegl1-mesa.
    sudo apt reinstall libegl-dev

헤더 파일 압축을 풀고

    cp include/EGL_platform/platform_fbdev/* include/EGL
    CFLAGS='-I/home/odroid/opengl-meson/include' ./configure --enable-video-mali  --disable-video-directfb --disable-directfb-shared

    make -j4

ge2d 를 사용하지 않는 sdl2는 아래 환경 변수를 사용하여 화면 회전이 가능함

    # Setup native display orientation for OGU
    export SDL_MALI_ORIENTATION=1
    # Setup application orientation (e.g. for "TATE Mode")
    export SDL_MALI_ROTATION=0
    # Final rotation is 'rotation = (SDL_MALI_ORIENTATION+SDL_MALI_ROTATION) % 4;'

위 소스는 아래 빌드 에러로 사용 못하고 있음

    build error
    In file included from /home/odroid/export/SDL-ge2d/src/video/mali-fbdev/SDL_maliopengles.c:8:
    /home/odroid/export/SDL-ge2d/src/video/mali-fbdev/SDL_malivideo.h:28:25: error: field 'native_display' has incomplete type
       28 |     struct fbdev_window native_display;

아래 패키지 설치는 효과가 없음

sudo apt install glmark2-es2-wayland

생성된 라이브러리는 심볼릭 링크를 만들어 준다.

sudo ln -s -f libSDL2-2.0.so.0.22.0 libSDL2-2.0.so.0

sdl2.0을 사용하는 에뮬레이터를 빌드해 준다.



ge2d 사용한 코드에서는
src/video/mali-fbdev/SDL_maliopengles.c
void MALI_Rotate_Blit(_THIS, SDL_Window *window, MALI_EGL_Surface *target, int rotation)

src/video/mali-fbdev/SDL_malivideo.c:

    current_mode.w = data->vinfo.xres;
    current_mode.h = data->vinfo.yres;



### advmame build

$ sudo apt-get update
$ sudo apt-get install build-essential git autoconf automake libsdl2-dev libasound2-dev libfreetype6-dev zlib1g-dev libexpat1-dev libslang2-dev libncurses5-dev

nbbatman 은 아래 에러를 출력하고 죽음
/lib/aarch64-linux-gnu/libc.so.6(__libc_start_main+0xe8) [0x7f89cd6e10]
advmame(+0x7b05cc) [0x558eb965cc]

advmenu 분석 - 등록되어 있지 않은 조이패트를 추가하기 위해서는

    /*
     * Include libretro definitions from:
     * https://github.com/libretro/retroarch-joypad-autoconfig/udev
     * and converted with joverride.python.
     */
    #include "joverride.dat"
            };

### retroarch build

retroarch dependency 확인
sudo apt-get install libudev-dev libxkbcommon-dev libsdl2-dev libasound2-dev libusb-1.0-0-dev libgles2-mesa-dev libgbm-dev libavcodec-dev libavformat-dev libavdevice-dev
sudo apt-get install libx11-xcb-dev libx11-xcb-dev libpulse-dev libvulkan-dev mali-fbdev

git clone https://github.com/libretro/RetroArch.git


./configure --enable-opengles3 --enable-opengles --disable-x11 --enable-alsa --enable-udev  --enable-sdl2


### DinguxCommander 구동

DinguxCommander 에서는 키 값을 게임컨트롤 설정 값을 활용해서 구동하고 있습니다.

export SDL_GAMECONTROLLERCONFIG="$(cat /home/odroid/controllerdb.txt)"
odroid

### openMSX build

gcc+10으로 빌드 필요함

sudo apt install gcc-7 g++-7 gcc-8 g++-8 gcc-9 g++-9 gcc-10 g++-10
sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-9 90 --slave /usr/bin/g++ g++ /usr/bin/g++-9 --slave /usr/bin/gcov gcov /usr/bin/gcov-9
sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-8 80 --slave /usr/bin/g++ g++ /usr/bin/g++-8 --slave /usr/bin/gcov gcov /usr/bin/gcov-8
sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 70 --slave /usr/bin/g++ g++ /usr/bin/g++-7 --slave /usr/bin/gcov gcov /usr/bin/gcov-7
sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-10 50 --slave /usr/bin/g++ g++ /usr/bin/g++-10 --slave /usr/bin/gcov gcov /usr/bin/gcov-10
sudo update-alternatives --config gcc

$ sudo apt-get update
sudo apt install libfreetype6-dev
$ sudo apt-get install libglew-dev libao-dev libogg-dev libtheora-dev libxml2-dev libvorbis-dev tcl-dev
./configure
make

bios 추가 방법

    $ cd .openMSX/share/
    $ wget http://bjorn.kuiper.nu/upload/retropie/systemroms.zip
    sudo apt install unzip
    $ unzip systemroms.zip
    $ rm systemroms.zip


### drastic

binary 묶음을 복사해주면 바로 실행이 된다.
sdl2 se2d 적용된 버젼을 사용하면 키 입력시 화면 바로 업데이트 안되는 문제점이 존재한다.
sdl2 nose2d 버젼은 실행되지 않는다.


jstest 설치 및 키값 확인

    sudo apt-get install -y jstest-gtk

4 : l, 5 : r, 6:l2, 7:r2
8 : up, 9: down, 10:left, 11:right, 12:exit 17:capture
13 : menu, 14 : select, 15 : start 16 : pause

### mupen64plus build

sudo apt-get install cmake libsamplerate0-dev libspeexdsp-dev libsdl2-dev libpng-dev libfreetype6-dev fonts-freefont-ttf libboost-filesystem-dev libgles2-mesa-dev libglew-dev libglu1-mesa-dev

make all -j7 BITS=64 USE_GLES=1 NEW_DYNAREC=1 V=1 HOST_CPU=aarch64 PIE=1 OPTFLAGS="-O3 -flto"


화면은 표시되지만 느림
